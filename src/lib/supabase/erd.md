# مخطط قاعدة بيانات GradTrack (ERD)

## الكيانات والعلاقات

### المستخدمون (Users)
- **id**: UUID (المفتاح الأساسي)
- **email**: نص (البريد الإلكتروني للمستخدم)
- **full_name**: نص (الاسم الكامل للمستخدم)
- **avatar_url**: نص (رابط صورة المستخدم)
- **role**: نص ('student', 'supervisor', 'admin')
- **created_at**: طابع زمني (وقت إنشاء الحساب)

### المشاريع (Projects)
- **id**: UUID (المفتاح الأساسي)
- **name**: نص (اسم المشروع)
- **description**: نص (وصف المشروع)
- **owner_id**: UUID (معرف المالك، مفتاح خارجي يشير إلى Users)
- **created_at**: طابع زمني (وقت إنشاء المشروع)
- **updated_at**: طابع زمني (وقت آخر تحديث)

### أعضاء المشروع (Project Members)
- **id**: UUID (المفتاح الأساسي)
- **project_id**: UUID (معرف المشروع، مفتاح خارجي يشير إلى Projects)
- **user_id**: UUID (معرف المستخدم، مفتاح خارجي يشير إلى Users)
- **role**: نص ('owner', 'supervisor', 'member')
- **created_at**: طابع زمني (وقت إضافة العضو)

### المنشورات (Posts)
- **id**: UUID (المفتاح الأساسي)
- **project_id**: UUID (معرف المشروع، مفتاح خارجي يشير إلى Projects)
- **user_id**: UUID (معرف المستخدم، مفتاح خارجي يشير إلى Users)
- **content**: نص (محتوى المنشور)
- **code_snippet**: نص (مقتطف الكود، اختياري)
- **image_url**: نص (رابط الصورة، اختياري)
- **created_at**: طابع زمني (وقت إنشاء المنشور)
- **updated_at**: طابع زمني (وقت آخر تحديث)

### مشاهدات المنشورات (Post Views)
- **id**: UUID (المفتاح الأساسي)
- **post_id**: UUID (معرف المنشور، مفتاح خارجي يشير إلى Posts)
- **user_id**: UUID (معرف المستخدم، مفتاح خارجي يشير إلى Users)
- **viewed_at**: طابع زمني (وقت المشاهدة)

### التعليقات (Comments)
- **id**: UUID (المفتاح الأساسي)
- **post_id**: UUID (معرف المنشور، مفتاح خارجي يشير إلى Posts)
- **user_id**: UUID (معرف المستخدم، مفتاح خارجي يشير إلى Users)
- **content**: نص (محتوى التعليق)
- **code_snippet**: نص (مقتطف الكود، اختياري)
- **image_url**: نص (رابط الصورة، اختياري)
- **created_at**: طابع زمني (وقت إنشاء التعليق)
- **updated_at**: طابع زمني (وقت آخر تحديث)

### الإشعارات (Notifications)
- **id**: UUID (المفتاح الأساسي)
- **user_id**: UUID (معرف المستخدم، مفتاح خارجي يشير إلى Users)
- **title**: نص (عنوان الإشعار)
- **content**: نص (محتوى الإشعار)
- **type**: نص ('post_created', 'comment_added', 'project_invitation', 'inactivity_alert')
- **related_id**: UUID (معرف العنصر المرتبط، اختياري)
- **is_read**: منطقي (هل تمت قراءة الإشعار)
- **created_at**: طابع زمني (وقت إنشاء الإشعار)

## العلاقات

1. **المستخدم - المشاريع**: علاقة واحد إلى متعدد (مستخدم واحد يمكن أن يكون مالكًا لعدة مشاريع)
2. **المشروع - الأعضاء**: علاقة متعدد إلى متعدد (مشروع يمكن أن يكون له عدة أعضاء، ومستخدم يمكن أن يكون عضوًا في عدة مشاريع)
3. **المشروع - المنشورات**: علاقة واحد إلى متعدد (مشروع واحد يمكن أن يحتوي على عدة منشورات)
4. **المستخدم - المنشورات**: علاقة واحد إلى متعدد (مستخدم واحد يمكن أن ينشئ عدة منشورات)
5. **المنشور - المشاهدات**: علاقة واحد إلى متعدد (منشور واحد يمكن أن يكون له عدة مشاهدات)
6. **المنشور - التعليقات**: علاقة واحد إلى متعدد (منشور واحد يمكن أن يحتوي على عدة تعليقات)
7. **المستخدم - التعليقات**: علاقة واحد إلى متعدد (مستخدم واحد يمكن أن ينشئ عدة تعليقات)
8. **المستخدم - الإشعارات**: علاقة واحد إلى متعدد (مستخدم واحد يمكن أن يتلقى عدة إشعارات)

## سياسات الأمان (RLS)

تم تكوين سياسات الأمان (Row Level Security) لضمان:

1. المستخدمون يمكنهم فقط رؤية المشاريع التي هم أعضاء فيها
2. المالكون والمشرفون فقط يمكنهم إضافة أعضاء للمشروع
3. المستخدمون يمكنهم إنشاء منشورات وتعليقات في المشاريع التي هم أعضاء فيها
4. المستخدمون يمكنهم فقط تعديل أو حذف المنشورات والتعليقات التي أنشأوها
5. المستخدمون يمكنهم فقط رؤية الإشعارات الخاصة بهم
